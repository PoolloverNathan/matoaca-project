[gd_scene load_steps=4 format=2]

[ext_resource path="res://tileset.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
resource_name = "gem"
script/source = "extends Node2D

enum COLOR { RED, YELLOW, GREEN, TEAL, BLUE, MAGENTA, DARK_GRAY, GRAY, LIGHT_GRAY, BLACK }
## The type of gem that this is.
enum TYPE {
	## A decorative gem that can freely be knocked over.
	DECORATIVE,
	## A gem that will give the player another level of shield. The color is forced to yellow.
	SHIELD,
	## A gem that causes the player to immediately win the level. The color is forced to blue.
	WIN,
	## A gem that causes the player to immediately win the level and unlock a secret path. The color is forced to red.
	SECRET_WIN,
	## A gem whose collection status is shown on the level icon and pause menu.
	COLLECTIBLE,
}
var TYPE_FORCE_COLOR_MAP = {
	TYPE.SHIELD: COLOR.YELLOW,
	TYPE.WIN: COLOR.BLUE,
	TYPE.SECRET_WIN: COLOR.RED
}
var COLOR_MAP = {
	COLOR.RED: Color(1, 0, 0),
	COLOR.YELLOW: Color(1, 1, 0),
	COLOR.GREEN: Color(0, 1, 0),
	COLOR.TEAL: Color(0, 1, 1),
	COLOR.BLUE: Color(0, 0, 1),
	COLOR.MAGENTA: Color(1, 0, 1),
	COLOR.DARK_GRAY: Color(0.25, 0.25, 0.25),
	COLOR.GRAY: Color(0.5, 0.5, 0.5),
	COLOR.LIGHT_GRAY: Color(0.75, 0.75, 0.75),
	COLOR.BLACK: Color(0, 0, 0)
}
export var color = Color(0.5, 0.5, 0.5) setget ,get_color
export(TYPE) var type
func get_color():
	if TYPE_FORCE_COLOR_MAP.has(type):
		return COLOR_MAP[TYPE_FORCE_COLOR_MAP.get(type)]
	else:
		return COLOR_MAP[color]
		
func _get(property):
	if property == \"color\":
		return get_color()
	return .get(property)
"

[sub_resource type="GDScript" id=2]
resource_name = "gem_color_tool"
script/source = "tool extends Sprite

func _process(_delta):
	modulate = owner.color
"

[node name="gem" type="Node2D"]
script = SubResource( 1 )
color = Color( 0.231373, 0.00392157, 0.00392157, 1 )
type = 2

[node name="Stand" type="StaticBody2D" parent="."]

[node name="Stand" type="Sprite" parent="Stand"]
texture = ExtResource( 1 )
region_enabled = true
region_rect = Rect2( 96, 16, 16, 16 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Stand"]
visible = false
polygon = PoolVector2Array( -6, 2, -2, 2, -1, 3, 1, 3, 2, 2, 6, 2, 6, 8, -6, 8 )

[node name="Gem" type="RigidBody2D" parent="."]

[node name="Gem" type="Sprite" parent="Gem"]
texture = ExtResource( 1 )
region_enabled = true
region_rect = Rect2( 96, 224, 16, 16 )

[node name="Filling" type="Sprite" parent="Gem/Gem"]
modulate = Color( 0.231373, 0.00392157, 0.00392157, 1 )
texture = ExtResource( 1 )
region_enabled = true
region_rect = Rect2( 112, 224, 16, 16 )
script = SubResource( 2 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Gem"]
visible = false
polygon = PoolVector2Array( -2, -6, -1, -7, 1, -7, 2, -6, 2, 1, 1, 2, -1, 2, -2, 1 )
